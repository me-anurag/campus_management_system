<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<div class="d-flex">

    <!-- Sidebar -->
    <div class="bg-dark text-white p-3" style="width:250px; min-height:100vh;">
        <h4>Admin Panel</h4>
        <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link text-white" href="/dashboard">Dashboard</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="/logout">Logout</a></li>
        </ul>
    </div>

    <!-- Main -->
    <div class="flex-grow-1 p-4">

        <h2>Campus Analytics Dashboard</h2>

        <!-- Stats -->
        <div class="row mt-4">
            <div class="col-md-3"><div class="card p-3 text-center shadow"><h5>Blocks</h5><h3>{{ total_blocks }}</h3></div></div>
            <div class="col-md-3"><div class="card p-3 text-center shadow"><h5>Classrooms</h5><h3>{{ total_classrooms }}</h3></div></div>
            <div class="col-md-3"><div class="card p-3 text-center shadow"><h5>Students</h5><h3>{{ total_students }}</h3></div></div>
            <div class="col-md-3"><div class="card p-3 text-center shadow"><h5>Faculty</h5><h3>{{ total_faculty }}</h3></div></div>
        </div>

        <!-- Overload / Underutilized Cards -->
        <div class="row mt-4">

            <div class="col-md-6">
                <div class="card text-white bg-danger shadow p-3"
                     data-bs-toggle="modal" data-bs-target="#overloadedModal"
                     style="cursor:pointer;">
                    <h5>Overloaded Rooms</h5>
                    <h3>{{ overloaded_rooms|length }}</h3>
                    <small>Click to View</small>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card text-white bg-primary shadow p-3"
                     data-bs-toggle="modal" data-bs-target="#underutilizedModal"
                     style="cursor:pointer;">
                    <h5>Underutilized Rooms</h5>
                    <h3>{{ underutilized_rooms|length }}</h3>
                    <small>Click to View</small>
                </div>
            </div>

        </div>

        <!-- Charts -->
        <div class="mt-5">
            <h4>Classroom Utilization</h4>
            <canvas id="utilChart"></canvas>
        </div>

        <div class="mt-5">
            <h4>Block Utilization</h4>
            <canvas id="blockChart"></canvas>
        </div>

        <div class="mt-5">
            <h4>Student Distribution</h4>
            <canvas id="courseChart"></canvas>
        </div>

        <div class="mt-5">
            <h4>Faculty Workload</h4>
            <canvas id="facultyChart"></canvas>
        </div>

    </div>
</div>

<!-- Modals -->
<div class="modal fade" id="overloadedModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5>Overloaded Rooms</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        {% if overloaded_rooms %}
            <ul class="list-group">
                {% for room in overloaded_rooms %}
                    <li class="list-group-item">
                        {{ room.room }} — {{ room.util }}%
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            No overloaded rooms.
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="underutilizedModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5>Underutilized Rooms</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        {% if underutilized_rooms %}
            <ul class="list-group">
                {% for room in underutilized_rooms %}
                    <li class="list-group-item">
                        {{ room.room }} — {{ room.util }}%
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            No underutilized rooms.
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
new Chart(document.getElementById('utilChart'), {
    type: 'bar',
    data: {
        labels: {{ room_labels|tojson }},
        datasets: [{
            label: 'Utilization %',
            data: {{ utilization_data|tojson }},
            backgroundColor: {{ bar_colors|tojson }}
        }]
    }
});

new Chart(document.getElementById('blockChart'), {
    type: 'bar',
    data: {
        labels: {{ block_labels|tojson }},
        datasets: [{
            label: 'Block Utilization %',
            data: {{ block_utilization|tojson }}
        }]
    }
});

new Chart(document.getElementById('courseChart'), {
    type: 'pie',
    data: {
        labels: {{ course_labels|tojson }},
        datasets: [{
            data: {{ course_counts|tojson }}
        }]
    }
});

new Chart(document.getElementById('facultyChart'), {
    type: 'bar',
    data: {
        labels: {{ faculty_labels|tojson }},
        datasets: [{
            label: 'Courses Assigned',
            data: {{ faculty_workload|tojson }}
        }]
    }
});
</script>

</body>
</html>