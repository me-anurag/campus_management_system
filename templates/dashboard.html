{% extends "base.html" %}
{% block content %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<h2>Campus Intelligence Dashboard</h2>

<!-- STAT CARDS -->
<div class="row mt-4">

    <div class="col-md-3">
        <div class="card p-3 text-center shadow">
            <h6>Total Blocks</h6>
            <h3>{{ total_blocks }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow">
            <h6>Total Classrooms</h6>
            <h3>{{ total_classrooms }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow">
            <h6>Total Students</h6>
            <h3>{{ total_students }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 text-center shadow">
            <h6>Campus Utilization</h6>
            <h3>{{ campus_util }}%</h3>
        </div>
    </div>

</div>

<!-- CLICKABLE ALERT CARDS -->
<div class="row mt-4">

    <div class="col-md-6">
        <div class="card bg-danger text-white p-3 shadow"
             data-bs-toggle="modal" data-bs-target="#overloadedModal"
             style="cursor:pointer;">
            <h5>Overloaded Rooms</h5>
            <h2>{{ overloaded|length }}</h2>
            <small>Click for Details</small>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card bg-primary text-white p-3 shadow"
             data-bs-toggle="modal" data-bs-target="#underutilizedModal"
             style="cursor:pointer;">
            <h5>Underutilized Rooms</h5>
            <h2>{{ underutilized|length }}</h2>
            <small>Click for Details</small>
        </div>
    </div>

</div>

<!-- CHARTS -->
<div class="row mt-5">

    <div class="col-md-6">
        <div class="card p-3 shadow">
            <h5>Classroom Utilization</h5>
            <canvas id="roomChart"></canvas>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card p-3 shadow">
            <h5>Block Utilization</h5>
            <canvas id="blockChart"></canvas>
        </div>
    </div>

</div>

<!-- SMART RECOMMENDATION -->
<div class="card mt-5 p-3 shadow">
    <h5>Smart Recommendation</h5>
    {% if recommendations %}
        {% for rec in recommendations %}
            <div class="alert alert-warning mt-2">
                {{ rec }}
            </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-success mt-2">
            System Balanced.
        </div>
    {% endif %}
</div>

<!-- MODALS -->

<div class="modal fade" id="overloadedModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5>Overloaded Rooms</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        {% for r in overloaded %}
            <p>{{ r }}</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="underutilizedModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5>Underutilized Rooms</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        {% for r in underutilized %}
            <p>{{ r }}</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
new Chart(document.getElementById('roomChart'), {
    type: 'bar',
    data: {
        labels: {{ room_labels|tojson }},
        datasets: [{
            data: {{ room_utilization|tojson }},
            backgroundColor: {{ room_colors|tojson }}
        }]
    }
});

new Chart(document.getElementById('blockChart'), {
    type: 'bar',
    data: {
        labels: {{ block_labels|tojson }},
        datasets: [{
            data: {{ block_util|tojson }}
        }]
    }
});
</script>

{% endblock %}